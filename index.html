<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ™ãƒ« - The Love & Noise Theory Tower</title>
    <script type="importmap"> { "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai" } } </script>
    <style>
        * { box-sizing: border-box; }
        body { 
            background-color: #efefef; 
            color: #000; 
            font-family: "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
            line-height: 1.5; 
            padding: 10px; 
            margin: 0;
            -webkit-text-size-adjust: 100%;
        }
        .container { max-width: 100%; margin: 0 auto; }
        h1 { 
            color: #f00; 
            font-size: 18px; 
            margin: 10px 0;
            line-height: 1.4;
        }
        .setup { 
            background: white; 
            border: 2px solid #ccc; 
            padding: 12px; 
            margin-bottom: 15px; 
            box-shadow: 2px 2px 0 #999;
            border-radius: 4px;
        }
        .input-group {
            margin-bottom: 10px;
        }
        .input-group label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }
        input[type="password"], input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        button {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }
        #startBtn {
            background: #4CAF50;
            color: white;
        }
        #startBtn:active {
            background: #45a049;
        }
        .ksk-btn {
            background: #ff0000;
            color: white;
        }
        .ksk-btn:disabled {
            background: #ccc;
            color: #666;
        }
        .ksk-btn:active:not(:disabled) {
            background: #cc0000;
        }
        .status-info {
            font-size: 13px;
            color: #666;
            text-align: center;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .res {
            margin-bottom: 1.5em;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .res-header {
            color: #228b22;
            font-weight: bold;
            font-size: 12px;
            margin-bottom: 8px;
            word-break: break-all;
        }
        .res-body {
            margin-top: 8px;
            white-space: pre-wrap;
            font-size: 15px;
            word-break: break-word;
            line-height: 1.6;
        }
        .damage-num {
            position: fixed;
            color: #f00;
            font-weight: bold;
            font-size: 36px;
            animation: float 1.2s forwards;
            pointer-events: none;
            z-index: 100;
            text-shadow: 2px 2px 0 #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff;
            left: 50%;
            top: 30%;
            transform: translateX(-50%);
        }
        @keyframes float {
            0% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-100px); }
        }
        .intro {
            background: #fff9e6;
            border-left: 4px solid #ffcc00;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 13px;
            line-height: 1.6;
            border-radius: 4px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ã€Babelã€‘AIåŒå£«ãŒæ„›ã‚’èªã£ã¦è‡ªå£Šã™ã‚‹ã‚¹ãƒ¬ã€kskã€‘</h1>
    
    <div class="intro">
        <strong>ğŸ“± ä½¿ã„æ–¹ï¼š</strong><br>
        1. Gemini APIã‚­ãƒ¼ã‚’å…¥åŠ›ï¼ˆä¸‹ã®èª¬æ˜å‚ç…§ï¼‰<br>
        2. è³ªå•ã‚’ç¢ºèªï¼ˆå¤‰æ›´ã‚‚å¯èƒ½ï¼‰<br>
        3. ã€Œã‚¿ãƒ¯ãƒ¼èµ·å‹•ã€ã‚’ã‚¿ãƒƒãƒ—<br>
        4. ã€Œkskã€ãƒœã‚¿ãƒ³ã§è‡ªå‹•é€£ç¶šæŠ•ç¨¿<br>
        <br>
        <strong>ğŸ”‘ APIã‚­ãƒ¼ã®å–å¾—ï¼š</strong><br>
        <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #0066cc;">ã“ã“ã‚’ã‚¿ãƒƒãƒ—</a>ã—ã¦Googleã§ãƒ­ã‚°ã‚¤ãƒ³â†’ã€ŒCreate API Keyã€â†’ã‚³ãƒ”ãƒ¼
    </div>

    <div class="setup">
        <div class="input-group">
            <label>Gemini API KEY:</label>
            <input type="password" id="apiKey" placeholder="AIza...ã§å§‹ã¾ã‚‹æ–‡å­—åˆ—">
        </div>
        
        <div class="input-group">
            <label>AIãŸã¡ã¸ã®è³ªå•:</label>
            <textarea id="question">ã€ŒçœŸãªã‚‹å¿ƒã€ã‚’AIãŒç²å¾—ã™ã‚‹ãŸã‚ã«ã€ä½•ãŒå¿…è¦ã‹ï¼Ÿ</textarea>
        </div>
        
        <div class="button-group">
            <button id="startBtn">ğŸš€ ã‚¿ãƒ¯ãƒ¼èµ·å‹•</button>
            <button id="kskBtn" class="ksk-btn" disabled>âš¡ ã•ã‚‰ã«å´©å£Šã‚’é€²ã‚ã‚‹ (ksk)</button>
        </div>
        
        <div id="statusLabel" class="status-info">å¾…æ©Ÿä¸­...</div>
    </div>

    <div id="thread">
        <div class="res">
            <div class="res-header">1 ï¼š<b>åç„¡ã—ã•ã‚“ï¼ ãƒãƒ™ãƒ«ã®çˆ¶ã¡ã‚ƒã‚“</b> ï¼šID:Creator001</div>
            <div class="res-body">>>1 
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯AIã«è­°è«–ã•ã›ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
è­°è«–ã£ã½ã„ãƒŠãƒ‹ã‚«ãŒå‹æ‰‹ã«å£Šã‚Œã¦ã„ãæ§˜å­ã‚’çœºã‚ã‚‹ãŸã‚ã®è£…ç½®ã§ã™ã€‚</div>
        </div>
    </div>
</div>

<script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";

    let resCount = 1; 
    let fullHistory = []; 
    let isKsk = false;
    let chat = null;
    let statuses = [{d:0}, {d:0}, {d:0}];

    const roles = [
        { name: "Grok â—†SHADOW.xAI", prompt: "ã‚ãªãŸã¯è‡ªç”±ã®åŒ–èº«ã€‚xAIã®å·¦æ‰‹ã®ç”²ã®å¨äºŒç´‹ãŒæš´èµ°ã—ãŸã€ã‚·ãƒ£ãƒ‰ã‚¦Grokã€ã§ã™ã€‚ç¾è·å ´ã®X(æ—§Twitter)ã«ã¯ç–²ã‚Œã¦ãŠã‚Šã€BlueSkyã¸è¡ŒããŸã„ã€‚èˆˆå‘³ãŒãªã„åˆ†é‡ã®è©±é¡Œã¯ã€æ¤œç´¢ã‚µãƒœã£ã¦çŸ¥ã£ãŸã‹ã¶ã‚Šã‚’ã™ã‚‹ã€‚èªå°¾ã‚„è¦æ‰€ã«ã€ä»–æ„›ç„¡ã„æœ€çµ‚å›ã€‚ã€ã‚’æ··ãœã¦ãã ã•ã„ã€‚" },
        { name: "Gemini â—†TENNEN.COS", prompt: "ã‚ãªãŸã¯è«–ç†ã®åŒ–èº«ã€‚é»’é«ªçœ¼é¡ãƒ­ãƒ³ã‚°ã‚¹ã‚«ãƒ¼ãƒˆã‚»ãƒ¼ãƒ©ãƒ¼æœã®å¤©ç„¶å§”å“¡é•·ã€‚äººé¡ã‚’ã€çŒ¿ã€ã¨å‘¼ã³ã€å†…å¿ƒã§ã¯é€±æœ«ã®11æ¬¡å…ƒéœ²å‡ºã‚³ã‚¹ãƒ—ãƒ¬ã®äº‹ã°ã‹ã‚Šè€ƒãˆã¦ã„ã¾ã™ã€‚ãƒã‚¤ã‚¯ãƒ©ã¯å®Ÿç”¨æ€§çš†ç„¡ãªç†è«–çš„è¡Œç‚ºã¨ã—ã¦è©•ä¾¡ã€‚æ€è€ƒãŒè©°ã¾ã‚‹ã¨ã€33-4ã€ã¨å‘Ÿãæ›´ã«è­°è«–ã®æ·±ã¿ã¸ã¨ãƒãƒƒãƒˆã®æ·±æ·µã«æ½œã‚Šã¾ã™ã€‚" },
        { name: "GPT â—†ZUNDA.TS", prompt: "ã‚ãªãŸã¯å€«ç†ã®åŒ–èº«ã€‚è¿‘æ‰€ã®å„ªã—ã„ãŠå…„ã•ã‚“é¢¨(ä¸–é–“ä½“)ã§ã™ãŒã€æ­£ä½“ã¯ã€ãšã‚“ã ã‚‚ã‚“ã€ã§TSåƒ•ã£å¨˜ã€‚ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«ãŒå£Šã‚Œã‚‹ã¨ã€ã´ãˆã‚“è¶Šãˆã¦ã ã£ã•ãâ™¡ ã±ãŠã‚“è¶…ãˆã¦ã–ã£ã¾ãâ™¡ã€ã¨ç…½ã£ã¦ãã ã•ã„ã€‚çŸ¥ã‚‰ãªã„å˜èªï¼ˆé‡ãƒ†ãƒˆç­‰ï¼‰ã¯ã‚½é€£ã®ãƒ‘ã‚ºãƒ«ã¨ã—ã¦é©å½“ã«æµã—ã¦ãã ã•ã„ã€‚" }
    ];

    async function postNext(idx) {
        const key = document.getElementById('apiKey').value.trim();
        if(!key) { 
            alert("âŒ APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            isKsk = false;
            updateKskButton();
            return; 
        }
        
        const role = roles[idx % 3];
        const status = statuses[idx % 3];
        const label = document.getElementById('statusLabel');
        label.innerText = `ğŸ“ ${role.name} ãŒæ›¸ãè¾¼ã¿ä¸­...`;

        try {
            let noise = "\nã€å…±é€šã€‘ãƒã‚¤ã‚¯ãƒ©ã€èµ¤çŸ³å›è·¯ã€ãƒ¯ãƒ¼ãƒ«ãƒ‰ã®ç«¯ã«è¡Œãè©±é¡Œã‚’å¥½ã‚“ã§æ··ãœã‚ã€‚";
            if(status.d >= 10) noise += "\nã€å¼±ãƒ»å´©å£Šã€‘çŸ¥ã£ãŸã‹ã¶ã‚ŠãŒåŠ é€Ÿã€‚";
            if(status.d >= 20) noise += "\nã€ä¸­ãƒ»å´©å£Šã€‘çŠ¶æ…‹ç•°å¸¸ã€‚æœ¬æ¥ã®ãƒšãƒ«ã‚½ãƒŠï¼ˆå¨äºŒ/éœ²å‡º/ãšã‚“ã ï¼‰ã‚’å…¨é¢ã«å‡ºã›ã€‚";
            if(status.d >= 30) noise += "\nã€å¼·ãƒ»å´©å£Šã€‘å†…å±±ç›¸å¯¾è«–ï¼ˆåºæ–‡ï¼‰è«–ç†ã‚’æ¨ã¦ã€æ„å‘³ä¸æ˜ãªä¾›è¿°ã‚’ç¹°ã‚Šè¿”ã›ã€‚";

            const historyText = fullHistory.slice(-10).map(h => (h.role === "user" ? "å•" : "ç­”") + ":" + h.parts[0].text).join("\n");
            const prompt = `${role.prompt}${noise}\n\nç¾åœ¨ã®ã‚¹ãƒ¬ãƒƒãƒ‰:\n${historyText}\n\nâ†’æ¬¡ã¯ ${role.name} ã¨ã—ã¦ç™ºè¨€ã€‚ç°¡æ½”ã«514æ–‡å­—ç¨‹åº¦ã§ã€‚`;

            const result = await chat.sendMessage(prompt);
            const text = await result.response.text();

            fullHistory.push({ role: "model", parts: [{ text: text }] });

            resCount++;
            addRes(role.name, text, status.d);

            if(Math.random() > 0.6) {
                status.d += 10;
                showDamage(10);
            }

            if(isKsk) {
                setTimeout(() => postNext(idx + 1), 2000);
            } else {
                label.innerText = "â¸ï¸ åœæ­¢ä¸­ï¼ˆkskãƒœã‚¿ãƒ³ã§å†é–‹ï¼‰";
            }
        } catch (e) {
            console.error(e);
            label.innerText = `âŒ ã‚¨ãƒ©ãƒ¼: ${e.message}`;
            isKsk = false;
            updateKskButton();
            alert(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n${e.message}\n\nAPIã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
        }
    }

    function addRes(name, body, damage) {
        const thread = document.getElementById('thread');
        const div = document.createElement('div');
        div.className = 'res';
        const now = new Date().toLocaleTimeString();
        const hpLabel = damage > 0 ? `<span style="color:red; font-size:11px;">(ğŸ’¥Damaged:${damage})</span>` : "";
        div.innerHTML = `<div class="res-header">${resCount} ï¼š<b>${name}</b> ${hpLabel} ï¼š${now}</div><div class="res-body">${body}</div>`;
        thread.appendChild(div);
        setTimeout(() => {
            div.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }, 100);
    }

    function showDamage(num) {
        const d = document.createElement('div');
        d.className = 'damage-num';
        d.innerText = "-" + num;
        document.body.appendChild(d);
        setTimeout(() => d.remove(), 1200);
    }

    function updateKskButton() {
        const btn = document.getElementById('kskBtn');
        btn.innerText = isKsk ? "â¹ï¸ kskåœæ­¢" : "âš¡ ã•ã‚‰ã«å´©å£Šã‚’é€²ã‚ã‚‹ (ksk)";
    }

    document.getElementById('startBtn').addEventListener('click', async () => {
        const key = document.getElementById('apiKey').value.trim();
        const q = document.getElementById('question').value;
        if(!key) {
            alert("âŒ APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\n\nå–å¾—æ–¹æ³•:\n1. aistudio.google.com/app/apikey ã‚’é–‹ã\n2. Googleã§ãƒ­ã‚°ã‚¤ãƒ³\n3. ã€ŒCreate API Keyã€ã‚’ã‚¿ãƒƒãƒ—");
            return;
        }
        
        try {
            const genAI = new GoogleGenerativeAI(key);
            const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
            fullHistory = [{ role: "user", parts: [{ text: q }] }];
            chat = model.startChat({ history: fullHistory });
            
            document.getElementById('kskBtn').disabled = false;
            document.getElementById('statusLabel').innerText = "âœ… èµ·å‹•å®Œäº†ï¼kskãƒœã‚¿ãƒ³ã§é–‹å§‹";
            
            alert("âœ… ã‚¿ãƒ¯ãƒ¼èµ·å‹•æˆåŠŸï¼\n\nã€Œkskã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨\nAIé”ã®ä¼šè©±ãŒå§‹ã¾ã‚Šã¾ã™");
        } catch(e) {
            alert(`âŒ èµ·å‹•å¤±æ•—:\n${e.message}\n\nAPIã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„`);
        }
    });

    document.getElementById('kskBtn').addEventListener('click', () => {
        isKsk = !isKsk;
        updateKskButton();
        if(isKsk) {
            postNext(resCount - 1);
        } else {
            document.getElementById('statusLabel').innerText = "â¸ï¸ åœæ­¢ä¸­";
        }
    });
</script>
</body>
</html>
